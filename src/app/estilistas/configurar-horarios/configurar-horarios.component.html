<section class="full-page-section">
  <div class="container">

    <!-- Header -->
    <div class="page-header mb-5">
      <div>
        <h2 class="section-title">Configurar Horarios</h2>
        <p class="section-subtitle" *ngIf="estilista">
          <i class="fas fa-user-tie me-2"></i>{{ estilista.nombreCompleto }}
        </p>
      </div>
      <button class="btn btn-secondary" (click)="volver()">
        <i class="fas fa-arrow-left me-2"></i>Volver
      </button>
    </div>

    <!-- Tabs de Navegación -->
    <div class="tabs-navigation mb-4">
      <button
        class="tab-btn"
        [class.active]="tabActiva === 'horario'"
        (click)="cambiarTab('horario')">
        <i class="fas fa-calendar-week me-2"></i>Horario Base
      </button>
      <button
        class="tab-btn"
        [class.active]="tabActiva === 'descansos'"
        (click)="cambiarTab('descansos')">
        <i class="fas fa-coffee me-2"></i>Descansos Fijos
      </button>
      <button
        class="tab-btn"
        [class.active]="tabActiva === 'bloqueos'"
        (click)="cambiarTab('bloqueos')">
        <i class="fas fa-ban me-2"></i>Bloqueos / Vacaciones
      </button>
    </div>

    <!-- ========== TAB 1: HORARIO BASE ========== -->
    <div class="tab-content" *ngIf="tabActiva === 'horario'">
      <div class="content-card">
        <h3 class="card-title">
          <i class="fas fa-clock me-2"></i>Jornada Laboral Semanal
        </h3>
        <p class="card-description">
          Define los días y horarios en los que el estilista estará disponible para atender clientes.
        </p>

        <!-- ⭐ ADVERTENCIA IMPORTANTE ⭐ -->
        <div class="alert alert-warning mb-4">
          <i class="fas fa-exclamation-triangle me-2"></i>
          <strong>Importante:</strong> No podrás desactivar días que tengan citas programadas.
          Debes cancelar o reasignar las citas primero.
        </div>

        <div class="horario-grid">
          <div
            *ngFor="let dia of diasSemana"
            class="dia-card"
            [class.dia-inactivo]="!dia.esLaborable">

            <div class="dia-header">
              <div class="form-check form-switch">
                <input
                  class="form-check-input"
                  type="checkbox"
                  [id]="'dia-' + dia.diaSemana"
                  [(ngModel)]="dia.esLaborable"
                  (change)="cambiarEstadoDia(dia)">
                <label class="form-check-label" [for]="'dia-' + dia.diaSemana">
                  {{ dia.nombreDia }}
                </label>
              </div>

              <!-- ⭐ INDICADOR DE ESTADO ⭐ -->
              <div class="dia-estado">
                <small [class.text-success]="dia.esLaborable" [class.text-muted]="!dia.esLaborable">
                  {{ getEstadoDia(dia) }}
                </small>
              </div>
            </div>

            <div class="dia-body" *ngIf="dia.esLaborable">
              <div class="time-input-group">
                <label>Inicio</label>
                <input
                  type="time"
                  class="form-control time-input"
                  [(ngModel)]="dia.horaInicio"
                  [name]="'inicio-' + dia.diaSemana">
              </div>
              <div class="time-separator">
                <i class="fas fa-arrow-right"></i>
              </div>
              <div class="time-input-group">
                <label>Fin</label>
                <input
                  type="time"
                  class="form-control time-input"
                  [(ngModel)]="dia.horaFin"
                  [name]="'fin-' + dia.diaSemana">
              </div>
            </div>

            <div class="dia-body-inactive" *ngIf="!dia.esLaborable">
              <i class="fas fa-times-circle"></i>
              <span>Día no laborable</span>
            </div>
          </div>
        </div>

        <div class="action-buttons mt-4">
          <button class="btn btn-primary btn-lg" (click)="guardarHorarioBase()">
            <i class="fas fa-save me-2"></i>Guardar Horario Base
          </button>
        </div>
      </div>
    </div>


    <!-- ========== TAB 2: DESCANSOS FIJOS ========== -->
    <div class="tab-content" *ngIf="tabActiva === 'descansos'">
      <div class="content-card">
        <h3 class="card-title">
          <i class="fas fa-coffee me-2"></i>Descansos Fijos Diarios
        </h3>
        <p class="card-description">
          Configura pausas recurrentes (ej: hora de almuerzo) que se aplicarán cada semana.
        </p>

        <!-- ⭐ ADVERTENCIA IMPORTANTE ⭐ -->
        <div class="alert alert-warning mb-4">
          <i class="fas fa-exclamation-triangle me-2"></i>
          <strong>Importante:</strong> No podrás agregar descansos en horarios que tengan citas programadas.
        </div>

        <!-- Formulario para agregar descanso -->
        <div class="add-form">
          <h4 class="form-subtitle">
            <i class="fas fa-plus-circle me-2"></i>Agregar Nuevo Descanso
          </h4>

          <div class="row g-3">
            <div class="col-md-4">
              <label class="form-label">Día de la semana</label>
              <select
                class="form-select"
                [(ngModel)]="nuevoDescanso.diaSemana"
                name="nuevoDescansoDia">
                <option [value]="dia.diaSemana" *ngFor="let dia of diasLaborables">
                  {{ dia.nombreDia }}
                </option>
              </select>
              <small class="text-muted d-block mt-1">
                <i class="fas fa-info-circle me-1"></i>
                Solo se muestran días laborables
              </small>
            </div>

            <div class="col-md-3">
              <label class="form-label">Hora Inicio</label>
              <input
                type="time"
                class="form-control"
                [(ngModel)]="nuevoDescanso.horaInicio"
                name="nuevoDescansoInicio">
            </div>

            <div class="col-md-3">
              <label class="form-label">Hora Fin</label>
              <input
                type="time"
                class="form-control"
                [(ngModel)]="nuevoDescanso.horaFin"
                name="nuevoDescansoFin">
            </div>

            <div class="col-md-2 d-flex align-items-end">
              <button class="btn btn-success w-100" (click)="agregarDescanso()">
                <i class="fas fa-plus me-2"></i>Agregar
              </button>
            </div>
          </div>
        </div>

        <!-- Lista de descansos configurados -->
        <div class="descansos-list mt-4" *ngIf="descansosFijos.length > 0">
          <h4 class="form-subtitle">
            <i class="fas fa-list me-2"></i>Descansos Configurados
          </h4>

          <div class="table-responsive">
            <table class="table table-dark table-hover">
              <thead>
              <tr>
                <th>Día</th>
                <th>Hora Inicio</th>
                <th>Hora Fin</th>
                <th>Duración</th>
                <th class="text-center">Acciones</th>
              </tr>
              </thead>
              <tbody>
              <tr *ngFor="let descanso of descansosFijos">
                <td>
                  <i class="fas fa-calendar-day me-2 text-warning"></i>
                  {{ descanso.nombreDia }}
                </td>
                <td>
                  <i class="fas fa-clock me-1"></i>
                  {{ descanso.horaInicio }}
                </td>
                <td>
                  <i class="fas fa-clock me-1"></i>
                  {{ descanso.horaFin }}
                </td>
                <td>
              <span class="badge bg-info">
                {{ calcularDuracion(descanso.horaInicio, descanso.horaFin) }}
              </span>
                </td>
                <td class="text-center">
                  <button
                    class="btn btn-icon btn-delete"
                    (click)="eliminarDescanso(descanso.diaSemana)"
                    title="Eliminar descanso">
                    <i class="fas fa-trash-alt"></i>
                  </button>
                </td>
              </tr>
              </tbody>
            </table>
          </div>
        </div>

        <div class="no-data-message" *ngIf="descansosFijos.length === 0">
          <i class="fas fa-info-circle fa-2x mb-3"></i>
          <p>No hay descansos fijos configurados.</p>
          <small class="text-muted">Los descansos se aplicarán automáticamente cada semana.</small>
        </div>

        <div class="action-buttons mt-4">
          <button
            class="btn btn-primary btn-lg"
            (click)="guardarDescansosFijos()"
            [disabled]="descansosFijos.length === 0">
            <i class="fas fa-save me-2"></i>Guardar Descansos
          </button>
        </div>
      </div>
    </div>


    <!-- ========== TAB 3: BLOQUEOS / VACACIONES ========== -->
    <div class="tab-content" *ngIf="tabActiva === 'bloqueos'">
      <div class="content-card">
        <h3 class="card-title">
          <i class="fas fa-ban me-2"></i>Bloqueos de Días Libres
        </h3>
        <p class="card-description">
          Bloquea rangos de fechas específicos (vacaciones, días personales, etc.).
        </p>

        <!-- ⭐ ADVERTENCIA IMPORTANTE ⭐ -->
        <div class="alert alert-warning mb-4">
          <i class="fas fa-exclamation-triangle me-2"></i>
          <strong>Importante:</strong> No podrás crear bloqueos en fechas que tengan citas programadas.
          Debes cancelar o reasignar las citas primero.
        </div>

        <!-- Formulario para agregar bloqueo -->
        <div class="add-form">
          <h4 class="form-subtitle">
            <i class="fas fa-plus-circle me-2"></i>Agregar Nuevo Bloqueo
          </h4>

          <div class="row g-3">
            <div class="col-md-3">
              <label class="form-label">Fecha Inicio</label>
              <input
                type="date"
                class="form-control"
                [(ngModel)]="nuevoBloqueo.fechaInicio"
                name="nuevoBloqueoInicio"
                [min]="getFechaMinima()">
              <small class="text-muted d-block mt-1">
                <i class="fas fa-info-circle me-1"></i>
                No se permiten fechas pasadas
              </small>
            </div>

            <div class="col-md-3">
              <label class="form-label">Fecha Fin</label>
              <input
                type="date"
                class="form-control"
                [(ngModel)]="nuevoBloqueo.fechaFin"
                name="nuevoBloqueoFin"
                [min]="nuevoBloqueo.fechaInicio || getFechaMinima()">
            </div>

            <div class="col-md-4">
              <label class="form-label">Razón</label>
              <input
                type="text"
                class="form-control"
                placeholder="Ej: Vacaciones, Día personal"
                [(ngModel)]="nuevoBloqueo.razon"
                name="nuevoBloqueoRazon"
                maxlength="200">
              <small class="text-muted d-block mt-1">
                Máximo 200 caracteres
              </small>
            </div>

            <div class="col-md-2 d-flex align-items-end">
              <button class="btn btn-success w-100" (click)="agregarBloqueo()">
                <i class="fas fa-plus me-2"></i>Agregar
              </button>
            </div>
          </div>
        </div>

        <!-- Lista de bloqueos configurados -->
        <div class="bloqueos-list mt-4" *ngIf="bloqueos.length > 0">
          <h4 class="form-subtitle">
            <i class="fas fa-list me-2"></i>Bloqueos Configurados
          </h4>

          <div class="bloqueos-grid">
            <div
              *ngFor="let bloqueo of bloqueos"
              class="bloqueo-card"
              [class.editing]="bloqueoEditando?.id === bloqueo.id"
              [ngClass]="getClaseBloqueo(bloqueo)">

              <!-- Modo Vista -->
              <div *ngIf="!bloqueoEditando || bloqueoEditando.id !== bloqueo.id">
                <div class="bloqueo-header">
              <span class="bloqueo-badge">
                <i class="fas fa-calendar-times me-2"></i>{{ bloqueo.razon }}
              </span>
                  <div class="bloqueo-actions">
                    <button
                      class="btn btn-icon btn-edit-small"
                      (click)="editarBloqueo(bloqueo)"
                      [disabled]="!esBloqueActivo(bloqueo)"
                      [title]="esBloqueActivo(bloqueo) ? 'Editar bloqueo' : 'No se puede editar un bloqueo pasado'">
                      <i class="fas fa-pencil-alt"></i>
                    </button>
                    <button
                      class="btn btn-icon btn-delete-small"
                      (click)="eliminarBloqueo(bloqueo.id)"
                      title="Eliminar bloqueo">
                      <i class="fas fa-trash-alt"></i>
                    </button>
                  </div>
                </div>

                <!-- ⭐ INDICADOR DE ESTADO ⭐ -->
                <div class="bloqueo-estado mb-2">
              <span
                class="badge"
                [class.bg-danger]="esBloqueActivo(bloqueo)"
                [class.bg-secondary]="!esBloqueActivo(bloqueo)">
                <i [class]="esBloqueActivo(bloqueo) ? 'fas fa-lock' : 'fas fa-history'"></i>
                {{ esBloqueActivo(bloqueo) ? 'Activo' : 'Finalizado' }}
              </span>
                </div>

                <div class="bloqueo-body">
                  <div class="bloqueo-date">
                    <i class="fas fa-calendar-day me-2"></i>
                    <strong>Desde:</strong> {{ formatearFecha(bloqueo.fechaInicio) }}
                  </div>
                  <div class="bloqueo-date">
                    <i class="fas fa-calendar-check me-2"></i>
                    <strong>Hasta:</strong> {{ formatearFecha(bloqueo.fechaFin) }}
                  </div>
                  <div class="bloqueo-duracion mt-2">
                    <i class="fas fa-hourglass-half me-2"></i>
                    <strong>Duración:</strong> {{ calcularDiasBloqueados(bloqueo.fechaInicio, bloqueo.fechaFin) }}
                  </div>
                </div>
              </div>

              <!-- Modo Edición -->
              <div *ngIf="bloqueoEditando && bloqueoEditando.id === bloqueo.id" class="edit-form">
                <div class="mb-3">
                  <label class="form-label">Fecha Inicio</label>
                  <input
                    type="date"
                    class="form-control"
                    [(ngModel)]="bloqueoEditando.fechaInicio"
                    name="editBloqueoInicio"
                    [min]="getFechaMinima()">
                </div>
                <div class="mb-3">
                  <label class="form-label">Fecha Fin</label>
                  <input
                    type="date"
                    class="form-control"
                    [(ngModel)]="bloqueoEditando.fechaFin"
                    name="editBloqueoFin"
                    [min]="bloqueoEditando.fechaInicio">
                </div>
                <div class="mb-3">
                  <label class="form-label">Razón</label>
                  <input
                    type="text"
                    class="form-control"
                    [(ngModel)]="bloqueoEditando.razon"
                    name="editBloqueoRazon"
                    maxlength="200">
                </div>
                <div class="edit-actions">
                  <button class="btn btn-secondary btn-sm" (click)="cancelarEdicionBloqueo()">
                    <i class="fas fa-times me-1"></i>Cancelar
                  </button>
                  <button class="btn btn-primary btn-sm" (click)="guardarEdicionBloqueo()">
                    <i class="fas fa-save me-1"></i>Guardar
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="no-data-message" *ngIf="bloqueos.length === 0">
          <i class="fas fa-info-circle fa-2x mb-3"></i>
          <p>No hay bloqueos configurados.</p>
          <small class="text-muted">Los bloqueos impedirán que se agenden citas en esas fechas.</small>
        </div>
      </div>
    </div>


  </div>
</section>

